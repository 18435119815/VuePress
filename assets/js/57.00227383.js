(window.webpackJsonp=window.webpackJsonp||[]).push([[57],{699:function(s,n,e){"use strict";e.r(n);var a=e(88),r=Object(a.a)({},(function(){var s=this,n=s.$createElement,e=s._self._c||n;return e("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[e("h1",{attrs:{id:"ssr"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#ssr"}},[s._v("#")]),s._v(" SSR")]),s._v(" "),e("blockquote",[e("p",[s._v("第一次请求之后，后端会把首屏完整的dom结构返回给前端并激活，用户后面再去点击超链接的话，应用会按照spa应用的方式执行，即跟普通的项目一样，不会再发送请求了")])]),s._v(" "),e("blockquote",[e("p",[s._v("对于正常的vue项目来说，当我们打开控制台查看dom结构的时候，只会得到一个id为app的div，这样不利于seo优化。而服务端渲染则可以帮助我们很好的解决这个事情")])]),s._v(" "),e("h2",{attrs:{id:"预备知识"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#预备知识"}},[s._v("#")]),s._v(" 预备知识")]),s._v(" "),e("ol",[e("li",[s._v("服务端知识express")])]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("npm i express -S\nnpm i nodemon -g   //实时启动node服务\nnpm i serve-favicon -S  //处理对于网站icon的请求 \n\n//以下是基础使用\nconst express = require('express')\n\n// 获取express实例\nconst server = express()\n\n// 编写路由处理不同请求\nserver.get('/',(req,res)=>{\n    res.send('HEY Mr哎呦喂')\n})\n\n// 监听端口\nserver.listen(80,()=>{\n    console.log('listen ready')\n})\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br"),e("span",{staticClass:"line-number"},[s._v("18")]),e("br"),e("span",{staticClass:"line-number"},[s._v("19")]),e("br")])]),e("h2",{attrs:{id:"基础实现"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#基础实现"}},[s._v("#")]),s._v(" 基础实现")]),s._v(" "),e("p",[s._v("将VUE实例成HTML并返回")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("安装vue服务渲染器(此处要注意渲染器版本要与VUE版本保持一致)\nnpm i vue-server-renderer -S\n\nconst path  = require('path')\nconst Vue = require('vue')\n//创建服务\nconst server = require('express')()\n//创建渲染器实例\nconst renderer = require('vue-server-renderer').createRenderer()\n//处理favicon\nconst favicon = resquire('serve-favicon')\nserver.use(favicon(path.join(__dirname,'../../public','favicon.ico')))\n\n\nserver.get('*', (req, res) => {\n\n  //创建vue实例\n  const app = new Vue({\n    data: {\n      message: 'hey Mr哎呦喂'\n    },\n    template: `<div>{{ message }}</div>`\n  })\n\n  //使用渲染器渲染vue实例并返回给前端\n  renderer.renderToString(app, (err, html) => {\n    if (err) {\n      res.status(500).end('Internal Server Error')\n      return\n    }\n    res.send(html)\n  })\n})\n\nserver.listen(80)\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br"),e("span",{staticClass:"line-number"},[s._v("18")]),e("br"),e("span",{staticClass:"line-number"},[s._v("19")]),e("br"),e("span",{staticClass:"line-number"},[s._v("20")]),e("br"),e("span",{staticClass:"line-number"},[s._v("21")]),e("br"),e("span",{staticClass:"line-number"},[s._v("22")]),e("br"),e("span",{staticClass:"line-number"},[s._v("23")]),e("br"),e("span",{staticClass:"line-number"},[s._v("24")]),e("br"),e("span",{staticClass:"line-number"},[s._v("25")]),e("br"),e("span",{staticClass:"line-number"},[s._v("26")]),e("br"),e("span",{staticClass:"line-number"},[s._v("27")]),e("br"),e("span",{staticClass:"line-number"},[s._v("28")]),e("br"),e("span",{staticClass:"line-number"},[s._v("29")]),e("br"),e("span",{staticClass:"line-number"},[s._v("30")]),e("br"),e("span",{staticClass:"line-number"},[s._v("31")]),e("br"),e("span",{staticClass:"line-number"},[s._v("32")]),e("br"),e("span",{staticClass:"line-number"},[s._v("33")]),e("br"),e("span",{staticClass:"line-number"},[s._v("34")]),e("br"),e("span",{staticClass:"line-number"},[s._v("35")]),e("br")])]),e("h2",{attrs:{id:"开始"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#开始"}},[s._v("#")]),s._v(" 开始")]),s._v(" "),e("h3",{attrs:{id:"目录结构"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#目录结构"}},[s._v("#")]),s._v(" 目录结构")]),s._v(" "),e("p",[s._v("我们除了main.js之外，还需要两个入口文件\nentry-client.js # 客户端入口 用于静态内容激活\nentry-server.js # 服务端入口 用于首屏内容渲染")]),s._v(" "),e("p",[s._v("因为我们使用的是服务端渲染 面对的是多个客户 每次请求过来都是一个新的客户  应该返回一个新的路由   防止相互影响")]),s._v(" "),e("p",[s._v("同理main.js中的vue也应该是一个工厂函数，那么我们开始动手修改")]),s._v(" "),e("p",[s._v("在router/index.js中")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("//先将Vue.use(VueRouter)后面的代码全部注释，并换成以下的\n\nexport function createRouter(){\n  return new VueRouter({\n    routes:[\n      {\n        path: '/',\n        name: 'Home',\n        component: Home\n      },\n      {\n        path: '/admin/:id',\n        name: 'admin',\n        component: () => import( '../views/Admin.vue')\n      },\n      {\n        path: '/login',\n        name: 'login',\n        component: () => import( '../views/Login.vue')\n      },\n      {\n        path: '*',\n        name: '404',\n        component: () => import('../views/404.vue')\n      }\n    ]\n  })\n}\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br"),e("span",{staticClass:"line-number"},[s._v("18")]),e("br"),e("span",{staticClass:"line-number"},[s._v("19")]),e("br"),e("span",{staticClass:"line-number"},[s._v("20")]),e("br"),e("span",{staticClass:"line-number"},[s._v("21")]),e("br"),e("span",{staticClass:"line-number"},[s._v("22")]),e("br"),e("span",{staticClass:"line-number"},[s._v("23")]),e("br"),e("span",{staticClass:"line-number"},[s._v("24")]),e("br"),e("span",{staticClass:"line-number"},[s._v("25")]),e("br"),e("span",{staticClass:"line-number"},[s._v("26")]),e("br"),e("span",{staticClass:"line-number"},[s._v("27")]),e("br"),e("span",{staticClass:"line-number"},[s._v("28")]),e("br")])])])}),[],!1,null,null,null);n.default=r.exports}}]);